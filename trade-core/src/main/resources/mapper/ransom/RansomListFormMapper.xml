<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.centaline.trans.ransom.repository.RansomListFormMapper">
	<resultMap id="BaseResultMap" type="com.centaline.trans.ransom.entity.ToRansomCaseVo" >
		<id column="PKID" property="pkid" jdbcType="BIGINT" />
	    <result column="RANSOM_CODE" property="ransomCode" jdbcType="VARCHAR" />
	    <result column="CASE_CODE" property="caseCode" jdbcType="VARCHAR" />
	    <result column="RANSOM_STATUS" property="ransomStatus" jdbcType="NVARCHAR" />
	    <result column="RANSOM_PROPERTY" property="ransomProperty" jdbcType="NVARCHAR" />
	    <result column="COM_ORG_CODE" property="comOrgCode" jdbcType="VARCHAR" />
	    <result column="BORRO_MONEY" property="borroMoney" jdbcType="DECIMAL" />
	    <result column="BORROWER_NAME" property="borrowerName" jdbcType="VARCHAR" />
	    <result column="BORROWER_TEL" property="borrowerTel" jdbcType="VARCHAR" />
	    <result column="ISSTOP" property="isstop" jdbcType="VARCHAR" />
	    <result column="STOP_TYPE" property="stopType" jdbcType="VARCHAR" />
	    <result column="STOP_REASON" property="stopReason" jdbcType="VARCHAR" />
	    <result column="ACCEPT_TIME" property="acceptTime" jdbcType="TIMESTAMP" />
	    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
	    <result column="CREATE_USER" property="createUser" jdbcType="VARCHAR" />
	    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
	    <result column="UPDATE_USER" property="updateUser" jdbcType="VARCHAR" />
	    <result column="FIN_ORG_ID" property="finOrgId" jdbcType="NVARCHAR" />
	</resultMap>
	<resultMap type="com.centaline.trans.common.entity.TgGuestInfo" id="guestMap">
		<id column="PKID" property="pkid" jdbcType="BIGINT"/>
    	<result column="guest_code" property="guestCode" jdbcType="VARCHAR"/>
    	<result column="case_code" property="caseCode" jdbcType="VARCHAR"/>
    	<result column="guest_name" property="guestName" jdbcType="VARCHAR"/>
    	<result column="guest_phone" property="guestPhone" jdbcType="VARCHAR"/>
	</resultMap>
	
	
	
	<select id="getRansomCase" resultMap="BaseResultMap">
		SELECT * FROM sctrans.T_RA_CASE WHERE CASE_CODE = #{caseCode,jdbcType=VARCHAR}
	</select>
	
	<select id="getGuestInfo" resultMap="guestMap">
		SELECT 
			GUEST_CODE guestCode,
			CASE_CODE caseCode,
			GUEST_NAME guestName,
			GUEST_PHONE guestPhone
		FROM 
			sctrans.T_TG_GUEST_INFO
		 WHERE 
		 	CASE_CODE = #{caseCode,jdbcType=VARCHAR}
	</select>
	
	<select id="getTsFinOrgIinfo" resultType="com.centaline.trans.mgr.entity.TsFinOrg">
		SELECT 
			FIN_ORG_NAME finOrgName,
			FIN_ORG_CODE finOrgCode,
			FA_FIN_ORG_CODE faFinOrgCode,
			FIN_ORG_NAME_YC finOrgNameYc
		FROM 
			sctrans.T_TS_FIN_ORG 
		 WHERE 
		 	FIN_ORG_CODE = #{finOrgCode,jdbcType=VARCHAR}
	</select>
	
	<select id="getRansomInfoByRansomCode" resultType="com.centaline.trans.ransom.vo.ToRansomVo">
		SELECT 
			app.RANSOM_CODE ransomCode,
			app.APPLY_TIME applyTime,
			app.REMAKE applyRemake,
			inter.INTERVIEW_TIME interviewTime,
			inter.REMAKE interviewRemake,
			rep.REPAY_TIME repayTime,
			rep.REMAKE repayRemake,
			can.CANCEL_TIME cancelTime,
			can.REMAKE cancelRemake,
			red.REDEEM_TIME redeemTime,
			red.REMAKE redeemRemake,
			pay.PAYMENT_TIME paymentTime,
			pay.REMAKE paymentRemake
		FROM	sctrans.T_RA_APPLY app 
		LEFT JOIN sctrans.T_RA_INTERVIEW inter ON inter.RANSOM_CODE = app.RANSOM_CODE
		LEFT JOIN	sctrans.T_RA_REPAY rep ON rep.RANSOM_CODE = inter.RANSOM_CODE
		LEFT JOIN	sctrans.T_RA_CANCEL can ON can.RANSOM_CODE = rep.RANSOM_CODE
		LEFT JOIN	sctrans.T_RA_REDEEM red ON red.RANSOM_CODE = can.RANSOM_CODE
		LEFT JOIN	sctrans.T_RA_PAYMENT pay ON pay.RANSOM_CODE = red.RANSOM_CODE
		WHERE
			app.RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
		
	</select>
	
	<select id="getRansomLinkInfoByCaseCode" resultType="com.centaline.trans.ransom.vo.ToRansomLinkVo">
		SELECT 
			ca.CASE_CODE caseCode,
			pro.PROPERTY_ADDR propertyAddr,
			cai.AGENT_NAME agentName,
			cai.GRP_NAME grpName,
			guest.GUEST_NAME seller,
			guest.GUEST_PHONE sellPhone,
			guest1.GUEST_NAME buyer,
			guest1.GUEST_PHONE buyPhone,
			par.USER_NAME userName,
			par.REAL_NAME realName
		FROM sctrans.T_TO_CASE_INFO ca
		INNER JOIN sctrans.T_TO_PROPERTY_INFO  pro ON ca.CASE_CODE = pro.CASE_CODE
		INNER JOIN sctrans.T_TO_CASE_INFO cai ON pro.CASE_CODE = cai.CASE_CODE
		INNER  JOIN sctrans.T_TG_GUEST_INFO guest ON cai.CASE_CODE = guest.CASE_CODE and guest.TRANS_POSITION='30006001'
		INNER JOIN sctrans.T_TG_GUEST_INFO guest1 ON cai.CASE_CODE = guest1.CASE_CODE and guest1.TRANS_POSITION='30006002'
		INNER JOIN sctrans.T_TO_CASE_PARTICIPANT par ON guest.CASE_CODE = par.CASE_CODE
		WHERE  
			par.POSITION = 'warrant'
			AND ca.CASE_CODE = #{caseCode,jdbcType=VARCHAR}
	</select>
	
	<insert id="addRansomDetail" parameterType="com.centaline.trans.ransom.entity.ToRansomCaseVo">
		insert into sctrans.T_RA_CASE (
			RANSOM_CODE, 
			CASE_CODE, 
			RANSOM_STATUS, 
			RANSOM_PROPERTY, 
			COM_ORG_CODE, 
			BORRO_MONEY, 
			BORROWER_NAME, 
			BORROWER_TEL, 
			ISSTOP, 
			STOP_TYPE, 
			STOP_REASON, 
			ACCEPT_TIME, 
			CREATE_TIME, 
			CREATE_USER, 
			UPDATE_TIME, 
			UPDATE_USER, 
			FIN_ORG_ID, 
			REMARK
      )
    values (
		#{ransomCode,jdbcType=VARCHAR}, 
		#{caseCode,jdbcType=VARCHAR}, 
		#{ransomStatus,jdbcType=VARCHAR}, 
		#{ransomProperty,jdbcType=NVARCHAR}, 
		#{comOrgCode,jdbcType=VARCHAR}, 
		#{borroMoney,jdbcType=DECIMAL}, 
		#{borrowerName,jdbcType=VARCHAR}, 
		#{borrowerTel,jdbcType=VARCHAR}, 
		#{isstop,jdbcType=VARCHAR}, 
		#{stopType,jdbcType=VARCHAR}, 
		#{stopReason,jdbcType=VARCHAR}, 
		#{acceptTime,jdbcType=TIMESTAMP}, 
		#{createTime,jdbcType=TIMESTAMP}, 
		#{createUser,jdbcType=VARCHAR}, 
		#{updateTime,jdbcType=TIMESTAMP}, 
		#{updateUser,jdbcType=VARCHAR}, 
		#{finOrgId,jdbcType=NVARCHAR}, 
		#{remark,jdbcType=LONGVARCHAR}
      )
	</insert>
	
	<update id="updateRansomDiscountinue" parameterType="com.centaline.trans.ransom.entity.ToRansomCaseVo">
		UPDATE 
			sctrans.T_RA_CASE
		SET
			STOP_TYPE = #{stopType,jdbcType=VARCHAR},
			STOP_REASON = #{stopReason,jdbcType=VARCHAR}
		WHERE
			CASE_CODE = #{caseCode,jdbcType=VARCHAR}
	</update>
	
	<update id="updateRansomCaseByRansomCode" parameterType="com.centaline.trans.ransom.entity.ToRansomCaseVo">
		UPDATE sctrans.T_RA_CASE SET 
			BORROWER_NAME = #{borrowerName,jdbcType=VARCHAR},
			BORROWER_TEL = #{borrowerTel,jdbcType=VARCHAR},
			BORRO_MONEY = #{borroMoney,jdbcType=DECIMAL},
			UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
			UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		WHERE
			RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
	</update>
	
	<update id="updateRansomTailinsByRansomCode" parameterType="com.centaline.trans.ransom.entity.ToRansomTailinsVo">
		UPDATE 
			sctrans.T_RA_TAILINS 
		SET 
			SIGN_TIME = #{signTime,jdbcType=TIMESTAMP},
			FIN_ORG_CODE = #{finOrgCode,jdbcType=VARCHAR},
			MORTGAGE_TYPE = #{mortgageType,jdbcType=VARCHAR},
			DIYA_TYPE = #{diyaType,jdbcType=VARCHAR},
			LOAN_MONEY = #{loanMoney,jdbcType=DECIMAL},
			REST_MONEY = #{restMoney,jdbcType=DECIMAL},
			UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
			UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		WHERE
			RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
	</update>
	
	<update id="updateRansomApplyInfoByRansomCode" parameterType="com.centaline.trans.ransom.entity.ToRansomApplyVo">
		UPDATE 
			sctrans.T_RA_APPLY 
		SET 
			APPLY_TIME = #{applyTime,jdbcType=TIMESTAMP},
			REMAKE = #{remark,jdbcType=VARCHAR},
			UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
			UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		WHERE 
			RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
	</update>
	
	<update id="updateRansomInterviewInfoByRansomCode" parameterType="com.centaline.trans.ransom.entity.ToRansomSignVo">
		UPDATE 
			sctrans.T_RA_INTERVIEW 
		SET 
			INTERVIEW_TIME = #{signTime,jdbcType=TIMESTAMP},
			REMAKE = #{remark,jdbcType=VARCHAR},
			UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
			UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		WHERE 
			RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
	</update>
	
	<update id="updateRansomRepayInfoByRansomCode" parameterType="com.centaline.trans.ransom.entity.ToRansomMortgageVo">
		UPDATE 
			sctrans.T_RA_REPAY 
		SET 
			REPAY_TIME = #{mortgageTime,jdbcType=TIMESTAMP},
			REMAKE = #{remark,jdbcType=VARCHAR},
			UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
			UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		WHERE 
			RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
	</update>
	
	<update id="updateRansomCancelInfoByRansomCode" parameterType="com.centaline.trans.ransom.entity.ToRansomCancelVo">
		UPDATE 
			sctrans.T_RA_CANCEL 
		SET 
			CANCEL_TIME = #{cancelTime,jdbcType=TIMESTAMP},
			REMAKE = #{remark,jdbcType=VARCHAR},
			UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
			UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		WHERE 
			RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
	</update>
	
	<update id="updateRansomRedeemInfoByRansomCode" parameterType="com.centaline.trans.ransom.entity.ToRansomPermitVo">
		UPDATE 
			sctrans.T_RA_REDEEM 
		SET 
			REDEEM_TIME = #{redeemTime,jdbcType=TIMESTAMP},
			REMAKE = #{remark,jdbcType=VARCHAR},
			UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
			UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		WHERE 
			RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
	</update>
	
	<update id="updateRansomPaymentInfoByRansomCode" parameterType="com.centaline.trans.ransom.entity.ToRansomPaymentVo">
		UPDATE 
			sctrans.T_RA_PAYMENT 
		SET 
			PAYMENT_TIME = #{paymentTime,jdbcType=TIMESTAMP},
			REMAKE = #{remark,jdbcType=VARCHAR},
			UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
			UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP}
		WHERE 
			RANSOM_CODE = #{ransomCode,jdbcType=VARCHAR}
	</update>
	
</mapper>