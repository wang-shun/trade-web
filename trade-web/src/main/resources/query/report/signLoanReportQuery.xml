<?xml version="1.0" encoding="UTF-8"?>
<querys>
	<dicts>
		<customDict id="calPgfRate" beanName="calPgfRate"></customDict>
		<customDict id="calRate" beanName="calRate"></customDict>
		<customDict id="calTotalByBank" beanName="calTotalByBank"></customDict>
		<customDict id="calTotalByBackConsultantWork" beanName="calTotalByBackConsultantWork"></customDict>
		<customDict id="calTotalBySignStatistics" beanName="calTotalBySignStatistics"></customDict>
	</dicts>
<formatters>
		<formatter id="dateFormatter" ref="" class="com.aist.common.quickQuery.formatter.DateFormatter">
			<properties>
				<property name="pattern">yyyy-MM-dd HH:mm:ss</property>
			</properties>
		</formatter>
		<formatter id="dateFormatter1" ref="" class="com.aist.common.quickQuery.formatter.DateFormatter" />
		<formatter id="integerFormater" ref="" class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="maximumFractionDigits">2</property>
			</properties>
		</formatter>
		<formatter id="emailFormater" ref="" class="com.aist.common.quickQuery.formatter.EmailFormatter"/>
	</formatters>
	
	<!-- 
		签约贷款模块-签约数据统计(总表)
	-->
	<query id="signStatisticsQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT '一次性付款' as groupName,
			 			(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE CASE_LOAN_REQ = 0 AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS caseCount,
			 			(SELECT round(isnull(SUM(CASE_CON_PRICE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE CASE_LOAN_REQ = 0 AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) as htAmount
					UNION ALL
					SELECT '纯公积金' as groupName,
			 			(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS caseCount,
			 			(SELECT round(isnull(SUM(CASE_CON_PRICE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) as htAmount
					UNION ALL
					SELECT '公司办理' as groupName,
			 			(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI=1 and (MORT_TYPE = '30016001' or MORT_TYPE = '30016002') AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS caseCount,
			 			(SELECT round(isnull(SUM(CASE_CON_PRICE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI=1 and (MORT_TYPE = '30016001' or MORT_TYPE = '30016002') AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) as htAmount
					UNION ALL
					SELECT '客户自办' as groupName,
			 			(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI=0 and (MORT_TYPE = '30016001' or MORT_TYPE = '30016002') AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS caseCount,
			 			(SELECT round(isnull(SUM(CASE_CON_PRICE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI=0 and (MORT_TYPE = '30016001' or MORT_TYPE = '30016002') AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) as htAmount
					UNION ALL
					SELECT '贷款待办' as groupName,
			 			(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE CASE_LOAN_REQ = 1 and MORT_TYPE is null AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS caseCount,
			 			(SELECT round(isnull(SUM(CASE_CON_PRICE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE CASE_LOAN_REQ = 1 and MORT_TYPE is null AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) as htAmount
	            ]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="groupName" title="类型"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="caseCount" title="单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="htAmount" title="合同价"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				
				
				<column type="virtual" 
						name="caseCountRate,totalCaseCount,totalHtAmount,totalCaseCountRate" 
						referencecol="caseCount,htAmount" 
						customDict="calTotalBySignStatistics" /> 
			</table-row>
		</grid>
	</query>

	<!-- 
		签约贷款模块-按照贵宾中心-组别-个人统计 
	-->
	<query id="signLoanDetailByGuibinQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT 
						 <if test="condition == 'init'">
							 c.CASE_DISTRICT_ID,
							 c.CASE_DISTRICT_NAME as groupName,
						 </if>
						 
						 <if test="condition == 'distinct'">
							 c.CASE_ORG_ID_F,
			 				 c.CASE_ORG_NAME_F as groupName,
						 </if>
						 
						 <if test="condition == 'team' || condition == 'consultant'">
							 c.CASE_LEADING_PROCESS_ID_F,
			 				 c.CASE_REAL_NAME_F as groupName,
						 </if>
						 
						 COUNT(c.CASE_DISPATCH_TIME) AS slCount,  --受理量
						 COUNT(c.CASE_REAL_CON_TIME) AS qyCount,  --签约量
						 COUNT(c.MORT_SIGN_DATE) AS sdCount,      --商贷办理量
						 
						 <if test="condition == 'init'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND CASE_DISTRICT_ID = c.CASE_DISTRICT_ID  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
						    (SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND CASE_DISTRICT_ID = c.CASE_DISTRICT_ID  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_DISTRICT_ID = c.CASE_DISTRICT_ID  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
						    (SELECT round(isnull(SUM(EVA_EVAL_FEE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_DISTRICT_ID = c.CASE_DISTRICT_ID  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						  <if test="condition == 'distinct'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND CASE_ORG_ID_F = c.CASE_ORG_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
			 				(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND CASE_ORG_ID_F = c.CASE_ORG_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_ORG_ID_F = c.CASE_ORG_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
			 				(SELECT round(isnull(SUM(EVA_EVAL_FEE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_ORG_ID_F = c.CASE_ORG_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						 <if test="condition == 'team' || condition == 'consultant'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND CASE_LEADING_PROCESS_ID_F = c.CASE_LEADING_PROCESS_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
						    (SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND CASE_LEADING_PROCESS_ID_F = c.CASE_LEADING_PROCESS_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_LEADING_PROCESS_ID_F = c.CASE_LEADING_PROCESS_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
						    (SELECT round(isnull(SUM(EVA_EVAL_FEE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_LEADING_PROCESS_ID_F = c.CASE_LEADING_PROCESS_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						 COUNT(c.TRANSFER_APP_PASS_TIME) AS ghCount,    --过户量
						 COUNT(c.ELOAN_KA_AMOUNT) AS eCardCount,  --E+卡证申请单数
						 round(isnull(SUM(c.ELOAN_KA_AMOUNT) / 10000,0),2) as eCardAmount,    --E+卡证金额
					     COUNT(c.ELOAN_PRO_AMOUNT) AS eProCount,   --E+贷款申请单数
						 round(isnull(SUM(c.ELOAN_PRO_AMOUNT) / 10000,0),2) AS eProAmount     --E+贷款金额
					FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c
					
					WHERE convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#
					
					
					<if test="condition == 'init'">
						GROUP BY c.CASE_DISTRICT_ID,c.CASE_DISTRICT_NAME
					</if>
					
					<if test="condition == 'distinct'">
					    and c.CASE_DISTRICT_ID = #condition_distinctId#
						GROUP BY c.CASE_ORG_ID_F,c.CASE_ORG_NAME_F
					</if>
					
					<if test="condition == 'team'">
						and c.CASE_ORG_ID_F = #condition_orgId#
						GROUP BY c.CASE_LEADING_PROCESS_ID_F,c.CASE_REAL_NAME_F
					</if>
					
					<if test="condition == 'consultant'">
						and c.CASE_LEADING_PROCESS_ID_F = #condition_leadingProcessId#
						GROUP BY c.CASE_LEADING_PROCESS_ID_F,c.CASE_REAL_NAME_F
					</if>
	            ]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="CASE_DISTRICT_ID" title="案件所属贵宾服务部Id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="CASE_ORG_ID_F" title="案件主办所在组id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="CASE_LEADING_PROCESS_ID_F" title="案件主办用户id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="groupName" title="案件所属贵宾服务部名称"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="slCount" title="受理量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="qyCount" title="签约量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="sdCount" title="商贷办理量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="zbCount" title="客户自办量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="gjjCount" title="公积金量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="ghCount" title="过户量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="pgfCount" title="收到评估费单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="pgfAmount" title="评估费实收"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eCardCount" title="E+卡证申请单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eCardAmount" title="E+卡证金额"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="eProCount" title="E+贷款申请单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eProAmount" title="E+贷款金额" sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				
				<column type="virtual" 
						name="totalSlCount,totalQyCount,totalSdCount,totalZbCount,totalGjjCount,totalGhCount,totalPgfRate,totalPgfAmount,totalECardCount,totalECardAmount,totalEProCount,totalEProAmount,pgfRate" 
						referencecol="slCount,qyCount,zbCount,gjjCount,ghCount,pgfCount,sdCount,pgfAmount,eCardCount,eCardAmount,eProCount,eProAmount" 
						customDict="calPgfRate" />
			</table-row>
		</grid>
	</query>
	
	
	<!-- 
		签约贷款模块-区董-总监-区经-分行统计 
	-->
	<query id="signLoanDetailByQudongQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT 
						 <if test="condition == 'init'">
							 c.JQYDS_EMPLOYEE_CODE,
			 				 c.JQYDS_NAME as groupName,
						 </if>
						 
						 <if test="condition == 'qudong'">
							 c.JQYZJ_CODE,
			 				 c.JQYZJ_NAME as groupName,
						 </if>
						 
						 <if test="condition == 'director'">
							 c.JQYJL_EMPLOYEE_CODE,
			 				 c.JQYJL_NAME as groupName,
						 </if>
						 
						 <if test="condition == 'qyManager' || condition == 'fhManager'">
							 c.JFHJL_EMPLOYEE_CODE,
			 				 c.JFHJL_NAME as groupName,
						 </if>
						 
						 COUNT(c.CASE_DISPATCH_TIME) AS slCount,  --受理量
						 COUNT(c.CASE_REAL_CON_TIME) AS qyCount,  --签约量
						 COUNT(c.MORT_SIGN_DATE) AS sdCount,      --商贷办理量
						 
						 <if test="condition == 'init'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND JQYDS_EMPLOYEE_CODE = c.JQYDS_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
						    (SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND JQYDS_EMPLOYEE_CODE = c.JQYDS_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND JQYDS_EMPLOYEE_CODE = c.JQYDS_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
						    (SELECT round(isnull(SUM(EVA_EVAL_FEE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND JQYDS_EMPLOYEE_CODE = c.JQYDS_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						  <if test="condition == 'qudong'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND JQYZJ_CODE = c.JQYZJ_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
			 				(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND JQYZJ_CODE = c.JQYZJ_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND JQYZJ_CODE = c.JQYZJ_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
			 				(SELECT round(isnull(SUM(EVA_EVAL_FEE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND JQYZJ_CODE = c.JQYZJ_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						 <if test="condition == 'director'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND JQYJL_EMPLOYEE_CODE = c.JQYJL_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
						    (SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND JQYJL_EMPLOYEE_CODE = c.JQYJL_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND JQYJL_EMPLOYEE_CODE = c.JQYJL_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
						    (SELECT round(isnull(SUM(EVA_EVAL_FEE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND JQYJL_EMPLOYEE_CODE = c.JQYJL_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						 
						 <if test="condition == 'qyManager' || condition == 'fhManager'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND JFHJL_EMPLOYEE_CODE = c.JFHJL_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
						    (SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND JFHJL_EMPLOYEE_CODE = c.JFHJL_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND JFHJL_EMPLOYEE_CODE = c.JFHJL_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
						    (SELECT round(isnull(SUM(EVA_EVAL_FEE) / 10000,0),2) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND JFHJL_EMPLOYEE_CODE = c.JFHJL_EMPLOYEE_CODE  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						 COUNT(c.TRANSFER_APP_PASS_TIME) AS ghCount,    --过户量
						 COUNT(c.ELOAN_KA_AMOUNT) AS eCardCount,  --E+卡证申请单数
						 round(isnull(SUM(c.ELOAN_KA_AMOUNT) / 10000,0),2) as eCardAmount,    --E+卡证金额
					     COUNT(c.ELOAN_PRO_AMOUNT) AS eProCount,   --E+贷款申请单数
						 round(isnull(SUM(c.ELOAN_PRO_AMOUNT) / 10000,0),2) AS eProAmount     --E+贷款金额
					FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c
					
					WHERE convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#
					
					
					<if test="condition == 'init'">
						GROUP BY c.JQYDS_EMPLOYEE_CODE,c.JQYDS_NAME
					</if>
					
					<if test="condition == 'qudong'">
					    and c.JQYDS_EMPLOYEE_CODE = #condition_qudongId#
						GROUP BY c.JQYZJ_CODE,c.JQYZJ_NAME
					</if>
					
					<if test="condition == 'director'">
						and c.JQYZJ_CODE = #condition_directorId#
						GROUP BY c.JQYJL_EMPLOYEE_CODE,c.JQYJL_NAME
					</if>
					
					<if test="condition == 'qyManager'">
						and c.JQYJL_EMPLOYEE_CODE = #condition_qyManagerId#
						GROUP BY c.JFHJL_EMPLOYEE_CODE,c.JFHJL_NAME
					</if>
					
					<if test="condition == 'fhManager'">
						and c.JFHJL_EMPLOYEE_CODE = #condition_fhManagerId#
						GROUP BY c.JFHJL_EMPLOYEE_CODE,c.JFHJL_NAME
					</if>
	            ]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="CASE_DISTRICT_ID" title="案件所属贵宾服务部Id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="CASE_ORG_ID_F" title="案件主办所在组id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="CASE_LEADING_PROCESS_ID_F" title="案件主办用户id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="groupName" title="案件所属贵宾服务部名称"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="slCount" title="受理量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="qyCount" title="签约量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="sdCount" title="商贷办理量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="zbCount" title="客户自办量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="gjjCount" title="公积金量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="ghCount" title="过户量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="pgfCount" title="收到评估费单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="pgfAmount" title="评估费实收"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eCardCount" title="E+卡证申请单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eCardAmount" title="E+卡证金额"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="eProCount" title="E+贷款申请单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eProAmount" title="E+贷款金额" sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				
				<column type="virtual" 
						name="totalSlCount,totalQyCount,totalSdCount,totalZbCount,totalGjjCount,totalGhCount,totalPgfRate,totalPgfAmount,totalECardCount,totalECardAmount,totalEProCount,totalEProAmount,pgfRate" 
						referencecol="slCount,qyCount,zbCount,gjjCount,ghCount,pgfCount,sdCount,pgfAmount,eCardCount,eCardAmount,eProCount,eProAmount" 
						customDict="calPgfRate" />
			</table-row>
		</grid>
	</query>
	
	
	<!-- 
		签约贷款模块-签贷款数据统计 
	-->
	<query id="signLoanQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT 
						'30016001' AS groupName,
			 			(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016001' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS caseCount,  
						(SELECT isnull(SUM(c.CASE_CON_PRICE) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016001' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS htAmount,  
						(SELECT isnull(SUM(c.MORT_COM_AMOUNT) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016001' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS sdAmount,  
						(SELECT isnull(SUM(c.MORT_PRF_AMOUNT) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016001' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS gjjAmount  
					UNION 
					SELECT 
						'30016002' AS groupName,
			 			(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016002' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS caseCount,  
						(SELECT isnull(SUM(c.CASE_CON_PRICE) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016002' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS htAmount,  
						(SELECT isnull(SUM(c.MORT_COM_AMOUNT) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016002' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS sdAmount,  
						(SELECT isnull(SUM(c.MORT_PRF_AMOUNT) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016002' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS gjjAmount  
					UNION 
					SELECT 
						'30016003' AS groupName,
			 			(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016003' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS caseCount,  
						(SELECT isnull(SUM(c.CASE_CON_PRICE) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016003' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS htAmount,  
						(SELECT isnull(SUM(c.MORT_COM_AMOUNT) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016003' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS sdAmount,  
						(SELECT isnull(SUM(c.MORT_PRF_AMOUNT) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_TYPE = '30016003' AND c.IS_DELEGATE_YUCUI = 1 AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS gjjAmount  
	            ]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="groupName" title="类型"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="caseCount" title="单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="htAmount" title="合同价"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="sdAmount" title="商贷金额"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="gjjAmount" title="公积金金额"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				
				<column type="virtual" 
						name="totalCaseCountRate,totalSdAmountRate,totalGjjAmountRate,tatalCaseCount,totalSdAmount,totalGjjAmount,totalHtAmount,caseCountRate,sdAmountRate,gjjAmountRate" 
						referencecol="caseCount,sdAmount,gjjAmount,htAmount" 
						customDict="calRate" /> 
			</table-row>
		</grid>
	</query>
	
	
	<!-- 
		签约贷款模块-后台交易顾问工作量统计
	-->
	<query id="backConsultantWorkQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT c.CASE_LEADING_PROCESS_ID_B,
						   c.CASE_REAL_NAME_B as groupName,
						   COUNT(c.CASE_REAL_PLS_TIME) AS cxgCount,  --查限购单数
						   COUNT(c.CASE_PRICING_TIME) AS hjCount,    --核价单数
						   COUNT(c.CASE_TAX_TIME) AS ssCount, --审税单数
						   COUNT(c.MORT_SIGN_DATE) AS gjjCount, --公积金办理单数
						   COUNT(c.TRANSFER_REAL_HT_TIME) AS ghCount,  --过户单数
						   COUNT(c.CASE_REAL_PROPERTY_GET_TIME) AS lzCount   --领证单数
					FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c
					WHERE c.CASE_REAL_NAME_B is not null and convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#
					GROUP BY c.CASE_LEADING_PROCESS_ID_B,c.CASE_REAL_NAME_B
	            ]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="groupName" title="交易顾问姓名"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="cxgCount" title="查限购单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="hjCount" title="核价单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="ssCount" title="审税单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="gjjCount" title="公积金办理单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="ghCount" title="过户单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="lzCount" title="领证单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
			
				<column type="virtual" 
						name="totalCxgCount,totalHjCount,totalSsCount,totalGjjCount,totalGhCount,totalLzCount" 
						referencecol="cxgCount,hjCount,ssCount,gjjCount,ghCount,lzCount" 
						customDict="calTotalByBackConsultantWork" />
			</table-row>
		</grid>
	</query>
	
	
	<!-- 
		签约贷款模块-贷款银行流向(商贷数据,不包含公积金)
		统计分行单数和金额数据
	-->
	<query id="branchBankQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT *
					FROM
					(
					select 
						FIN_ORG_NAME_YC as groupName,
						(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_FA_FIN_ORG_CODE = FIN_ORG_CODE AND c.IS_DELEGATE_YUCUI = 1 AND (c.MORT_TYPE = '30016001' OR c.MORT_TYPE = '30016002') AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS caseCount,
						(SELECT isnull(SUM(c.MORT_COM_AMOUNT) / 10000,0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c WHERE c.MORT_FA_FIN_ORG_CODE = FIN_ORG_CODE AND c.IS_DELEGATE_YUCUI = 1 AND (c.MORT_TYPE = '30016001' OR c.MORT_TYPE = '30016002') AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#) AS sdAmount
					from sctrans.T_TS_FIN_ORG 
					where fin_org_code in 
					(
						select distinct FA_FIN_ORG_CODE 
						from sctrans.T_TS_FIN_ORG 
						where FIN_ORG_CODE in (select FIN_ORG_CODE from sctrans.T_TS_SUP ts where ts.SUP_CAT='0')
					) 
					) t
					ORDER BY t.sdAmount DESC
	            ]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="groupName" title="分行名称"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="caseCount" title="案件单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="sdAmount" title="商贷金额"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				
				<column type="virtual" 
						name="totalCaseCount,totalSdAmount" 
						referencecol="caseCount,sdAmount" 
						customDict="calTotalByBank" />
			</table-row>
		</grid>
	</query>
	
	<!-- 
		签约贷款模块-贷款银行流向(商贷数据,不包含公积金)
		统计支行单数和金额数据
	-->
	<query id="subBranchBankQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT c.MORT_FIN_BRANCH_NAME AS branchBankName,
						   c.MORT_FIN_SUB_BRANCH_NAME AS subBranchBankName,
						   c.IS_RUWEI_BANK as isRuweiBank,
						   COUNT(*) AS caseCount,    --案件单数
						   round(isnull(SUM(c.MORT_COM_AMOUNT) / 10000,0),2) AS sdAmount  --商贷金额,不统计公积金金额
					FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c
					WHERE c.IS_DELEGATE_YUCUI = 1 AND (c.MORT_TYPE = '30016001' OR c.MORT_TYPE = '30016002') AND convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#
					GROUP BY c.MORT_FIN_BRANCH_NAME,c.MORT_FIN_SUB_BRANCH_NAME,c.IS_RUWEI_BANK
					ORDER BY SUM(c.MORT_COM_AMOUNT) DESC
					OFFSET 0 ROWS FETCH  next 20 ROWS ONLY
	            ]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="branchBankName" title="分行名称"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="subBranchBankName" title="支行名称"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="isRuweiBank" title="是否是入围银行"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="caseCount" title="案件单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="sdAmount" title="商贷金额"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				
				<column type="virtual" 
						name="totalCaseCount,totalSdAmount" 
						referencecol="caseCount,sdAmount" 
						customDict="calTotalByBank" /> 
			</table-row>
		</grid>
	</query>
	
	
</querys>