<?xml version="1.0" encoding="UTF-8"?>
<querys>
	<dicts>
		<customDict id="convertValue" beanName="convertValue"></customDict>
	</dicts>
	<formatters>
		<formatter id="dateFormatter" ref=""
			class="com.aist.common.quickQuery.formatter.DateFormatter">
			<properties>
				<property name="pattern">yyyy-MM-dd HH:mm:ss</property>
			</properties>
		</formatter>
		<formatter id="numberFormater" ref=""
			class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="groupingUsed">true</property>
				<property name="maximumFractionDigits">3</property>
				<property name="maximumIntegerDigits">40</property>
				<property name="minimumFractionDigits">0</property>
				<property name="minimumIntegerDigits">1</property>
			</properties>
		</formatter>
		<formatter id="integerFormater" ref=""
			class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="maximumFractionDigits">0</property>
			</properties>
		</formatter>
		<formatter id="emailFormater" ref=""
			class="com.aist.common.quickQuery.formatter.EmailFormatter" />
	</formatters>
	<query id="queryCastTransferItemList" cacheCount="true">
		<searchCondition>
		</searchCondition>
		<searchSql>
			<baseSql>
				<![CDATA[
				select 					
					distinct(CASE_CODE), 
					PKID,
					PROPERTY_ADDR ,
					T.REAL_NAME , 
					T.ORG_NAME, 
					transferDate, 
					caseTransferDate , 
					status,
					GRP_NAME, 
					AR_NAME ,  
					wz.ORG_NAME AS VORG_NAME , 
					WZ.REAL_NAME AS VREAL_NAME  
					
				from (
					select c.pkid,c.case_code , p.PROPERTY_ADDR , zg.REAL_NAME, zg.ORG_NAME, i.AR_NAME, i.GRP_CODE,I.GRP_NAME, 
					(SELECT TOP 1 tar.OPERATOR_TIME FROM sctrans.T_TO_APPROVE_RECORD tar WHERE tar.PART_CODE = 'Guohu' and tar.CASE_CODE = c.CASE_CODE ORDER BY tar.OPERATOR_TIME desc) transferDate,
					(SELECT TOP 1 tar.OPERATOR_TIME FROM sctrans.T_TO_APPROVE_RECORD tar WHERE tar.PART_CODE = 'GuohuApprove' and tar.CASE_CODE = c.CASE_CODE ORDER BY tar.OPERATOR_TIME desc) caseTransferDate, 
					v.long_ AS  status
					from sctrans.t_to_case c 
					inner join sctrans.T_TO_PROPERTY_INFO p on c.CASE_CODE = p.CASE_CODE 
					left join sctrans.V_USER_ORG_JOB zg on c.ORG_ID = zg.ORG_ID and zg.JOB_CODE ='manager'
					inner join sctrans.T_TO_CASE_info i on c.case_code = i.case_code
					inner join sctrans.T_TO_WORKFLOW w on c.case_code = w.case_code 
					and  w.BUSINESS_KEY = 'operation_process' and w.STATUS in (0, 4)
					inner join sctrans.act_hi_varinst v on v.PROC_INST_ID_ = w.INST_CODE AND v.name_='GuohuApprove') t 
					LEFT JOIN SCTRANS.SYS_ORG O ON T.GRP_CODE = O.ORG_CODE AND O.IS_DELETED=0
					LEFT JOIN SCTRANS.T_SYS_ORG_HIERARCHY OH ON O.ID = OH.ORG_ID
					LEFT JOIN SCTRANS.V_USER_ORG_JOB WZ ON WZ.ORG_ID = OH.BUSIWZ_ID AND WZ.JOB_CODE = 'JQYDS' AND WZ.IS_LEADER = 1
					where 1=1
					 <ifNotNull caseTransferDateStart>
						AND t.caseTransferDate &gt; #caseTransferDateStart#
					</ifNotNull>
					<ifNotNull caseTransferDateEnd>
						AND t.caseTransferDate &lt; #caseTransferDateEnd#
					</ifNotNull>					
					<ifNotNull transferDateStart>
						AND t.transferDate &gt; #transferDateStart#
					</ifNotNull>
					<ifNotNull transferDateEnd>
						AND t.transferDate &lt; #transferDateEnd#
					</ifNotNull>
					<ifNotNull orgName>
						AND T.ORG_NAME like '%' + #orgName# + '%' 
					</ifNotNull>
					<ifNotNull TransferStatus>
						AND status = #TransferStatus#
					</ifNotNull>
					<ifNotNull vrealName>
						AND WZ.REAL_NAME like '%' + #vrealName# + '%' 
					</ifNotNull>
					<ifNotNull managerName>
						AND T.REAL_NAME like '%' + #managerName# + '%' 
					</ifNotNull>
					<ifNotNull caseCode>
						AND CASE_CODE = #caseCode#
					</ifNotNull>
					<ifNotNull propertyAddr>
						AND PROPERTY_ADDR like '%' + #propertyAddr# + '%' 
					</ifNotNull>
				]]>
			</baseSql>
			<orderBySql>
				ORDER BY transferDate DESC,caseTransferDate DESC
			</orderBySql>
			<groupSql>
			</groupSql>
		</searchSql>
		<grid>
			<table-row>				
				<column type="both" name="CASE_CODE" index="" checkbox="" display="案件编号" customDict="" sysDict="" format="" width="90" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="PKID" index="" checkbox="" display="案件ID" customDict="" sysDict="" format="" width="90" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="PROPERTY_ADDR" index="" checkbox="" display="产证地址" customDict="" sysDict="" format="" width="180" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="REAL_NAME" index="" checkbox="" display="主管" customDict="" sysDict="" format="" width="60" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="ORG_NAME" index="" checkbox="" display="组别" customDict="" sysDict="" format="" width="60" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="transferDate" index="" checkbox="" display="过户时间" customDict="" sysDict="" beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss" width="60" isSort="true" align="" halign="" order="" resizable="" />
				<column type="both" name="caseTransferDate" index="" checkbox="" display="过户审批时间" customDict="" sysDict="" beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss" width="60" isSort="true" align="" halign="" order="" resizable="" />
				<column type="both" name="status" index="" checkbox="" display="是否审批通过" customDict="" sysDict="" format="" width="60" isSort="" align="" halign="" order="" resizable="" />
		
				<column type="both" name="GRP_NAME" index="" checkbox="" display="店组" customDict="" sysDict="" format="" width="" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="AR_NAME" index="" checkbox="" display="片区" customDict="" sysDict="" format="" width="60" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="VORG_NAME" index="" checkbox="" display="区域" customDict="" sysDict="" format="" width="60" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="VREAL_NAME" index="" checkbox="" display="所属分行" customDict="" sysDict="" format="" width="120" isSort="" align="" halign="" order="" resizable="" />
				<column type="virtual" name="status1" display="是否审批通过" referencecol="status"  customDict="convertValue"/>
			</table-row>
		</grid>
	</query>
</querys>
