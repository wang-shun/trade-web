<?xml version="1.0" encoding="UTF-8"?>
<querys>
	<dicts>
		<customDict id="calPgfRate" beanName="calPgfRate"></customDict>
	</dicts>
<formatters>
		<formatter id="dateFormatter" ref="" class="com.aist.common.quickQuery.formatter.DateFormatter">
			<properties>
				<property name="pattern">yyyy-MM-dd HH:mm:ss</property>
			</properties>
		</formatter>
		<formatter id="dateFormatter1" ref="" class="com.aist.common.quickQuery.formatter.DateFormatter" />
		<formatter id="integerFormater" ref="" class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="maximumFractionDigits">0</property>
			</properties>
		</formatter>
		<formatter id="emailFormater" ref="" class="com.aist.common.quickQuery.formatter.EmailFormatter"/>
		<formatter id="amountFormater" ref="" class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="maximumFractionDigits">2</property>
			</properties>
		</formatter>
	</formatters>


	<query id="signLoanDetailByGuibinQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT 
						 <if test="condition == 'district'">
							 c.CASE_DISTRICT_ID,
							 c.CASE_DISTRICT_NAME as groupName,
						 </if>
						 
						 <if test="condition == 'team'">
							 c.CASE_ORG_ID_F,
			 				 c.CASE_ORG_NAME_F as groupName,
						 </if>
						 
						 <if test="condition == 'consultant'">
							 c.CASE_LEADING_PROCESS_ID_F,
			 				 c.CASE_REAL_NAME_F as groupName,
						 </if>
						 
						 COUNT(c.CASE_DISPATCH_TIME) AS slCount,  --受理量
						 COUNT(c.CASE_REAL_CON_TIME) AS qyCount,  --签约量
						 COUNT(c.MORT_SIGN_DATE) AS sdCount,      --商贷办理量
						 
						 <if test="condition == 'district'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND CASE_DISTRICT_ID = c.CASE_DISTRICT_ID  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
						    (SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND CASE_DISTRICT_ID = c.CASE_DISTRICT_ID  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_DISTRICT_ID = c.CASE_DISTRICT_ID  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
						    (SELECT isnull(SUM(EVA_EVAL_FEE),0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_DISTRICT_ID = c.CASE_DISTRICT_ID  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						  <if test="condition == 'team'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND CASE_ORG_ID_F = c.CASE_ORG_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
			 				(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND CASE_ORG_ID_F = c.CASE_ORG_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_ORG_ID_F = c.CASE_ORG_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
			 				(SELECT isnull(SUM(EVA_EVAL_FEE),0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_ORG_ID_F = c.CASE_ORG_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						 <if test="condition == 'consultant'">
							(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE IS_DELEGATE_YUCUI = 0 AND CASE_LEADING_PROCESS_ID_F = c.CASE_LEADING_PROCESS_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# and BELONG_MONTH = #searchBelongMonth#) AS zbCount,    --客户自办量
						    (SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE MORT_TYPE = '30016003' AND CASE_LEADING_PROCESS_ID_F = c.CASE_LEADING_PROCESS_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS gjjCount,  --公积金量
						 	(SELECT COUNT(*) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_LEADING_PROCESS_ID_F = c.CASE_LEADING_PROCESS_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfCount,  --收到评估费单数
						    (SELECT isnull(SUM(EVA_EVAL_FEE),0) FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO WHERE EVA_EVAL_FEE IS NOT NULL AND MORT_SIGN_DATE IS NOT NULL AND CASE_LEADING_PROCESS_ID_F = c.CASE_LEADING_PROCESS_ID_F  AND convert(varchar(7),CASE_REAL_CON_TIME,120) = #searchDateTime# AND BELONG_MONTH = #searchBelongMonth#) AS pgfAmount,  --评估费实收
						 </if>
						 
						 COUNT(c.TRANSFER_APP_PASS_TIME) AS ghCount,    --过户量
						 COUNT(c.ELOAN_KA_AMOUNT) AS eCardCount,  --E+卡证申请单数
						 isnull(SUM(c.ELOAN_KA_AMOUNT),0) as eCardAmount,    --E+卡证金额
					     COUNT(c.ELOAN_PRO_AMOUNT) AS eProCount,   --E+贷款申请单数
						 isnull(SUM(c.ELOAN_PRO_AMOUNT),0) AS eProAmount     --E+贷款金额
					FROM sctrans.T_RPT_HISTORY_CASE_BASE_INFO c
					WHERE convert(varchar(7),c.CASE_REAL_CON_TIME,120) = #searchDateTime# AND c.BELONG_MONTH = #searchBelongMonth#
					
					<if test="condition == 'district'">
						GROUP BY c.CASE_DISTRICT_ID,c.CASE_DISTRICT_NAME
					</if>
					
					<if test="condition == 'team'">
						GROUP BY c.CASE_ORG_ID_F,c.CASE_ORG_NAME_F
					</if>
					
					<if test="condition == 'consultant'">
						GROUP BY c.CASE_LEADING_PROCESS_ID_F,c.CASE_REAL_NAME_F
					</if>
	            ]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="CASE_DISTRICT_ID" title="案件所属贵宾服务部Id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="CASE_ORG_ID_F" title="案件主办所在组id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="CASE_LEADING_PROCESS_ID_F" title="案件主办用户id"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="groupName" title="案件所属贵宾服务部名称"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="slCount" title="受理量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="qyCount" title="签约量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="sdCount" title="商贷办理量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="zbCount" title="客户自办量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="gjjCount" title="公积金量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="ghCount" title="过户量"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="pgfCount" title="收到评估费单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="pgfAmount" title="评估费实收"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eCardCount" title="E+卡证申请单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eCardAmount" title="E+卡证金额"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="eProCount" title="E+贷款申请单数"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="both" name="eProAmount" title="E+贷款金额"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
				<column type="virtual" name="pgfRate" referencecol="pgfCount,sdCount" customDict="calPgfRate" title="评估费转化率"  sysDict="" format="" width="0" isSort="" align="" halign="" order="" resizable=""/>
			</table-row>
		</grid>
	</query>
</querys>