<?xml version="1.0" encoding="UTF-8"?>
<querys>
	<dicts>
		<customDict id="convertValue" beanName="convertValue"></customDict>
	</dicts>
	<formatters>
		<formatter id="dateFormatter" ref=""
			class="com.aist.common.quickQuery.formatter.DateFormatter">
			<properties>
				<property name="pattern">yyyy-MM-dd HH:mm:ss</property>
			</properties>
		</formatter>
		<formatter id="numberFormater" ref=""
			class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="groupingUsed">true</property>
				<property name="maximumFractionDigits">3</property>
				<property name="maximumIntegerDigits">40</property>
				<property name="minimumFractionDigits">0</property>
				<property name="minimumIntegerDigits">1</property>
			</properties>
		</formatter>
		<formatter id="integerFormater" ref=""
			class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="maximumFractionDigits">0</property>
			</properties>
		</formatter>
		<formatter id="emailFormater" ref=""
			class="com.aist.common.quickQuery.formatter.EmailFormatter" />
	</formatters>
	<query id="queryCastTransferExcelItemList" cacheCount="true">
		<searchCondition>
		</searchCondition>
		<searchSql>
			<baseSql>
				<![CDATA[
					select CASE_CODE, PROPERTY_ADDR ,T.REAL_NAME , T.ORG_NAME, transferDate, caseTransferDate , status, GRP_NAME , AR_NAME ,  wz.ORG_NAME AS VORG_NAME , WZ.REAL_NAME AS VREAL_NAME  from (
					select c.case_code , p.PROPERTY_ADDR , zg.REAL_NAME, zg.ORG_NAME, i.AR_NAME, i.GRP_CODE,I.GRP_NAME, 
					(select top 1 tgh.end_time_ from sctrans.act_hi_taskinst tgh where w.INST_CODE = tgh.proc_inst_id_ and tgh.task_def_key_='Guohu' order by id_ desc) transferDate , 
					(select top 1 tgha.end_time_ from sctrans.act_hi_taskinst tgha where w.INST_CODE = tgha.proc_inst_id_ and tgha.task_def_key_='GuohuApprove' order by id_ desc) caseTransferDate, 
					v.long_ AS  status
					from sctrans.t_to_case c 
					inner join sctrans.T_TO_PROPERTY_INFO p on c.CASE_CODE = p.CASE_CODE 
					left join sctrans.V_USER_ORG_JOB zg on c.ORG_ID = zg.ORG_ID and zg.JOB_CODE ='manager'
					inner join sctrans.T_TO_CASE_info i on c.case_code = i.case_code
					inner join sctrans.T_TO_WORKFLOW w on c.case_code = w.case_code 
					and  w.BUSINESS_KEY = 'operation_process' and w.STATUS in (0, 4)
					inner join sctrans.act_hi_varinst v on v.PROC_INST_ID_ = w.INST_CODE AND v.name_='GuohuApprove') t 
					LEFT JOIN SCTRANS.SYS_ORG O ON T.GRP_CODE = O.ORG_CODE
					LEFT JOIN SCTRANS.T_SYS_ORG_HIERARCHY OH ON O.ID = OH.ORG_ID
					LEFT JOIN SCTRANS.V_USER_ORG_JOB WZ ON WZ.ORG_ID = OH.BUSIWZ_ID AND WZ.JOB_CODE = 'JQYDS' AND WZ.IS_LEADER = 1
					where 1=1
					 <ifNotNull caseTransferDateStart>
						AND t.caseTransferDate &gt; #caseTransferDateStart#
					</ifNotNull>
					<ifNotNull caseTransferDateEnd>
						AND t.caseTransferDate &lt; #caseTransferDateEnd#
					</ifNotNull>
				]]>
			</baseSql>
			<orderBySql>
				ORDER BY TRANSFERDATE DESC,CASETRANSFERDATE DESC
			</orderBySql>
			<groupSql>
			</groupSql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="CASE_CODE"  title="案件编号" customDict="" hidden="false" />
				<column type="both" name="PROPERTY_ADDR" title="产证地址" customDict=""  hidden="false" />
				<column type="both" name="REAL_NAME" title="主管" customDict="" hidden="false" />
				<column type="both" name="ORG_NAME"  title="组别" customDict=""  hidden="false"/>
				<column type="both" name="transferDate" title="过户时间" customDict="" beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss" hidden="false" />
				<column type="both" name="caseTransferDate" title="过户审批时间" customDict="" hidden="false" beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss"/>
				<column type="both" name="status" title="是否审批通过" customDict="" hidden="false"/>
				<column type="virtual" name="status1" title="是否审批通过" referencecol="status"  customDict="convertValue"/>
				<column type="both" name="GRP_NAME" title="店组" customDict="" hidden="false" />
				<column type="both" name="AR_NAME" title="片区" customDict="" hidden="false" />
				<column type="both" name="VORG_NAME" title="区域" customDict="" hidden="false" />
				<column type="both" name="VREAL_NAME" title="区董" customDict="" hidden="false"/>
				
			</table-row>
		</grid>
	</query>
</querys>
