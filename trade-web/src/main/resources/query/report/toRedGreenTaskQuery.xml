<?xml version="1.0" encoding="UTF-8"?>
<querys>
	<dicts>
		<customDict id="convertValue" beanName="convertValue"></customDict>
		<customDict id="convertColor" beanName="convertColor"></customDict>
	</dicts>
	<formatters>
		<formatter id="dateFormatter" ref=""
			class="com.aist.common.quickQuery.formatter.DateFormatter">
			<properties>
				<property name="pattern">yyyy-MM-dd HH:mm:ss</property>
			</properties>
		</formatter>
		<formatter id="numberFormater" ref=""
			class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="groupingUsed">true</property>
				<property name="maximumFractionDigits">3</property>
				<property name="maximumIntegerDigits">40</property>
				<property name="minimumFractionDigits">0</property>
				<property name="minimumIntegerDigits">1</property>
			</properties>
		</formatter>
		<formatter id="integerFormater" ref=""
			class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="maximumFractionDigits">0</property>
			</properties>
		</formatter>
		<formatter id="emailFormater" ref=""
			class="com.aist.common.quickQuery.formatter.EmailFormatter" />
	</formatters>
	<query id="queryRedGreenTaskCountList" cacheCount="true">
		<searchCondition>
		</searchCondition>
		<searchSql>
			<baseSql>
				<![CDATA[
					select t1.orgName1,t1.realName1,t1.orgName2,t1.realName2,ISNULL(t2.count1,0) as yellow, ISNULL(t3.count1,0) as red ,GETDATE()  as importtime,t1.id from (
select org1.id id,org2.ORG_NAME orgName1,u2.REAL_NAME  realName1,org1.ORG_NAME orgName2  ,u1.REAL_NAME as realName2 from sctrans.sys_org org1
left join sctrans.V_USER_ORG_JOB uoj
on org1.ID=uoj.ORG_ID
right join sctrans.SYS_JOB j
on j.ID=uoj.JOB_ID and j.JOB_CODE='Manager'
left join sctrans.SYS_USER u1 on u1.id=uoj.USER_ID
left join sctrans.V_USER_ORG_JOB uoj1
on org1.PARENT_ID=uoj1.ORG_ID
right join sctrans.SYS_JOB j1
on j1.id=uoj1.JOB_ID and j1.JOB_CODE='director'
left join sctrans.SYS_USER u2 on u2.id=uoj1.USER_ID
left join sctrans.SYS_ORG org2 
on org2.ID=uoj1.ORG_ID 

 where org1.PARENT_ID in ('FF5BC56E0E4B45289DAA5721A494C7C5',
'8a8493d453141f3301532c9568011af9',
'd5878adf8b0c4032aeae895c701ed693',
'de81a98a8ec341caa8e9bc77c46cd370',
'54b3233fdf994d9987e7c8febc223588',
'960089538bc54a9a9139ef52ceb45b33',
'6114AB949B4445828D4383977C4FAC71',
'6a84979158b942b78a8a5921cc30b8c3') ) t1 
  LEFT join(select id as orgId,color,count(*) as count1 from (
					  SELECT min(l.color) as color,t.CASE_CODE as caseCode,t.PART_CODE as taskName,tp.PROPERTY_ADDR as propertyAddress,u.REAL_NAME as realName
					  	  ,t.EST_PART_TIME as estPartTime,ta.ID_,ta.PROC_INST_ID_,sysOrg.id
							 FROM [sctrans].[T_TO_TRANS_PLAN] as t 
							 left join sctrans.T_TO_PROPERTY_INFO as tp
							 on t.case_code=tp.case_code
							  left join sctrans.t_to_workflow as w
							  on w.case_code=t.CASE_CODE 
							   left join sctrans.act_ru_task ta
							  on ta.[TASK_DEF_KEY_]=t.PART_CODE and w.INST_CODE=ta.[PROC_INST_ID_]and ta.suspension_state_='1'
							  left join sctrans.LAMP_RULE l
							  on GETDATE()-t.EST_PART_TIME>=l.DELAYTIME
							  left join sctrans.SYS_USER as u 
							  on ta.ASSIGNEE_=u.USERNAME
							  left join sctrans.V_USER_ORG_JOB as uoj
							  on uoj.[USER_ID]=u.ID
							  left join sctrans.SYS_ORG as sysOrg
							  on sysOrg.ID=uoj.org_id
							  where u.id is not null
							  	  
							  group by t.CASE_CODE,t.PART_CODE,tp.PROPERTY_ADDR ,u.REAL_NAME,t.EST_PART_TIME,ta.ID_,ta.PROC_INST_ID_,sysOrg.id
						
							  
							  )as a where color &lt;&gt; '2' group by id,color)  t2 on t1.id=t2.orgId and t2.color=0
							  
 left join(select id as orgId,color,count(*) as count1 from (
					  SELECT min(l.color) as color,t.CASE_CODE as caseCode,t.PART_CODE as taskName,tp.PROPERTY_ADDR as propertyAddress,u.REAL_NAME as realName
					  	  ,t.EST_PART_TIME as estPartTime,ta.ID_,ta.PROC_INST_ID_,sysOrg.id
							 FROM [sctrans].[T_TO_TRANS_PLAN] as t 
							 left join sctrans.T_TO_PROPERTY_INFO as tp
							 on t.case_code=tp.case_code
							  left join sctrans.t_to_workflow as w
							  on w.case_code=t.CASE_CODE 
							   left join sctrans.act_ru_task ta
							  on ta.[TASK_DEF_KEY_]=t.PART_CODE and w.INST_CODE=ta.[PROC_INST_ID_] and ta.suspension_state_='1'
							  left join sctrans.LAMP_RULE l
							  on GETDATE()-t.EST_PART_TIME>=l.DELAYTIME
							  left join sctrans.SYS_USER as u 
							  on ta.ASSIGNEE_=u.USERNAME
							  left join sctrans.V_USER_ORG_JOB as uoj
							  on uoj.[USER_ID]=u.ID
							  left join sctrans.SYS_ORG as sysOrg
							  on sysOrg.ID=uoj.org_id
							  where u.id is not null
							  	  
							  group by t.CASE_CODE,t.PART_CODE,tp.PROPERTY_ADDR ,u.REAL_NAME,t.EST_PART_TIME,ta.ID_,ta.PROC_INST_ID_,sysOrg.id
						
							  
							  )as a where color &lt;&gt; '2' group by id,color)
							  t3 on t1.id=t3.orgId and t3.color=1
				]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
			<groupSql>
			</groupSql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="orgName1" index="" checkbox="" display="贵宾服务部" customDict="" sysDict="" format="" width="90" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="realName1" index="" checkbox="" display="总监" customDict="" sysDict="" format="" width="90" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="orgName2" index="" checkbox="" display="组别" customDict="" sysDict="" format="" width="90" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="realName2" index="" checkbox="" display="主管" customDict="" sysDict="" format="" width="120" isSort="" align="" halign="" order="" resizable="" />
				<column type="both" name="yellow" index="" checkbox="" display="黄灯" customDict="" sysDict="" format=""  align="" halign="" order="" resizable="" />
				<column type="both" name="red" index="" checkbox="" display="红灯" customDict="" sysDict="" format=""  align="" halign="" order="" resizable="" />
				<column type="both" name="importtime" index="" checkbox="" display="导出时间" customDict="" sysDict="" align="" halign="" order="" resizable=""  beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss" />
				<column type="both" name="id" index="" checkbox="" display="" customDict="" sysDict="" format=""  align="" halign="" order="" resizable="" />
			</table-row>
		</grid>
	</query>
	<query id="queryRedGreenTaskDetailList" cacheCount="true">
		<searchCondition>
		</searchCondition>
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT t1.orgName1,t1.realName1,t1.orgName2,t1.realName2,t2.*,GETDATE()  as IMPORTTIME from (
        select org1.id id,org2.ORG_NAME orgName1,u2.REAL_NAME  realName1,org1.ORG_NAME orgName2  ,u1.REAL_NAME as realName2 from sctrans.sys_org org1
        left join sctrans.V_USER_ORG_JOB uoj
        on org1.ID=uoj.ORG_ID
        right join sctrans.SYS_JOB j
        on j.ID=uoj.JOB_ID and j.JOB_CODE='Manager'
        left join sctrans.SYS_USER u1 on u1.id=uoj.USER_ID
        left join sctrans.V_USER_ORG_JOB uoj1
        on org1.PARENT_ID=uoj1.ORG_ID
        right join sctrans.SYS_JOB j1
        on j1.id=uoj1.JOB_ID and j1.JOB_CODE='director'
        left join sctrans.SYS_USER u2 on u2.id=uoj1.USER_ID
        left join sctrans.SYS_ORG org2 
        on org2.ID=uoj1.ORG_ID 
        
         where org1.PARENT_ID in ('FF5BC56E0E4B45289DAA5721A494C7C5',
        '8a8493d453141f3301532c9568011af9',
        'd5878adf8b0c4032aeae895c701ed693',
        'de81a98a8ec341caa8e9bc77c46cd370',
        '54b3233fdf994d9987e7c8febc223588',
        '960089538bc54a9a9139ef52ceb45b33',
        '6114AB949B4445828D4383977C4FAC71',
        '6a84979158b942b78a8a5921cc30b8c3') )
t1 inner join(select * from (
        SELECT  min(l.color) as color,t.CASE_CODE , (select name from sctrans.sys_dict where type='part_code' and code = t.PART_CODE) TASKNAME,tp.PROPERTY_ADDR,u.REAL_NAME
          ,t.EST_PART_TIME,sysOrg.id orgid
                 FROM [sctrans].[T_TO_TRANS_PLAN] as t 
                 left join sctrans.T_TO_PROPERTY_INFO as tp
                 on t.case_code=tp.case_code
                  left join sctrans.t_to_workflow as w
                  on w.case_code=t.CASE_CODE 
                   left join sctrans.act_ru_task ta
                  on ta.[TASK_DEF_KEY_]=t.PART_CODE and w.INST_CODE=ta.[PROC_INST_ID_]and ta.suspension_state_='1'
                  left join sctrans.LAMP_RULE l
                  on GETDATE()-t.EST_PART_TIME>=l.DELAYTIME
                  left join sctrans.SYS_USER as u 
                  on ta.ASSIGNEE_=u.USERNAME
                  left join sctrans.V_USER_ORG_JOB as uoj
                  on uoj.[USER_ID]=u.ID
                  left join sctrans.SYS_ORG as sysOrg
                  on sysOrg.ID=uoj.org_id
                  where u.id is not NULL
                  and l.color != '2'
                  group by t.CASE_CODE,t.PART_CODE,tp.PROPERTY_ADDR ,u.REAL_NAME,t.EST_PART_TIME,ta.ID_,ta.PROC_INST_ID_,sysOrg.id
        
                  )as a ) t2 on t1.id=t2.orgId 
                  
                  <ifNotNull organId>
							   where t1.id = #organId#
				  </ifNotNull>
                  
				]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
			<groupSql>
			</groupSql>
		</searchSql>
		<grid>
			<table-row>
			
				<column type="both" name="orgName1"  display="贵宾服务部" customDict=""  />
				<column type="both" name="realName1"  display="总监" customDict="" />
				<column type="both" name="orgName2"  display="组别" customDict=""  />
				<column type="both" name="realName2" display="主管" customDict=""  />
				
				<column type="both" name="color" display="红黄灯" customDict="" />
				<column type="virtual" name="color1" display="红黄灯" referencecol="color"  customDict="convertColor"/>
				<column type="both" name="CASE_CODE"  display="案件编号" customDict=""  />
				<column type="both" name="TASKNAME"  display="任务名" customDict=""  />
				<column type="both" name="PROPERTY_ADDR"  display="产证地址" customDict="" />
				<column type="both" name="REAL_NAME"  display="经办人" customDict="" />
				<column type="both" name="EST_PART_TIME"  display="预计完成时间" customDict="" beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss"/>
				<column type="both" name="PROPERTY_ADDR"  display="产证地址" customDict=""  />
				<column type="both" name="IMPORTTIME" display="导出时间" customDict=""  beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss"/>
			</table-row>
		</grid>
	</query>
	
	<query id="queryRedGreenTaskExcelItemList" cacheCount="true">
		<searchCondition>
		</searchCondition>
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT t1.orgName1,t1.realName1,t1.orgName2,t1.realName2,t2.*,GETDATE()  as IMPORTTIME from (
        select org1.id id,org2.ORG_NAME orgName1,u2.REAL_NAME  realName1,org1.ORG_NAME orgName2  ,u1.REAL_NAME as realName2 from sctrans.sys_org org1
        left join sctrans.V_USER_ORG_JOB uoj
        on org1.ID=uoj.ORG_ID
        right join sctrans.SYS_JOB j
        on j.ID=uoj.JOB_ID and j.JOB_CODE='Manager'
        left join sctrans.SYS_USER u1 on u1.id=uoj.USER_ID
        left join sctrans.V_USER_ORG_JOB uoj1
        on org1.PARENT_ID=uoj1.ORG_ID
        right join sctrans.SYS_JOB j1
        on j1.id=uoj1.JOB_ID and j1.JOB_CODE='director'
        left join sctrans.SYS_USER u2 on u2.id=uoj1.USER_ID
        left join sctrans.SYS_ORG org2 
        on org2.ID=uoj1.ORG_ID 
        
         where org1.PARENT_ID in ('FF5BC56E0E4B45289DAA5721A494C7C5',
        '8a8493d453141f3301532c9568011af9',
        'd5878adf8b0c4032aeae895c701ed693',
        'de81a98a8ec341caa8e9bc77c46cd370',
        '54b3233fdf994d9987e7c8febc223588',
        '960089538bc54a9a9139ef52ceb45b33',
        '6114AB949B4445828D4383977C4FAC71',
        '6a84979158b942b78a8a5921cc30b8c3') )
t1 inner join(select * from (
        SELECT  min(l.color) as color,t.CASE_CODE , (select name from sctrans.sys_dict where type='part_code' and code = t.PART_CODE) TASKNAME,tp.PROPERTY_ADDR,u.REAL_NAME
          ,t.EST_PART_TIME,sysOrg.id orgid
                 FROM [sctrans].[T_TO_TRANS_PLAN] as t 
                 left join sctrans.T_TO_PROPERTY_INFO as tp
                 on t.case_code=tp.case_code
                  left join sctrans.t_to_workflow as w
                  on w.case_code=t.CASE_CODE 
                   left join sctrans.act_ru_task ta
                  on ta.[TASK_DEF_KEY_]=t.PART_CODE and w.INST_CODE=ta.[PROC_INST_ID_]and ta.suspension_state_='1'
                  left join sctrans.LAMP_RULE l
                  on GETDATE()-t.EST_PART_TIME>=l.DELAYTIME
                  left join sctrans.SYS_USER as u 
                  on ta.ASSIGNEE_=u.USERNAME
                  left join sctrans.V_USER_ORG_JOB as uoj
                  on uoj.[USER_ID]=u.ID
                  left join sctrans.SYS_ORG as sysOrg
                  on sysOrg.ID=uoj.org_id
                  where u.id is not NULL
                  and l.color != '2'
                  group by t.CASE_CODE,t.PART_CODE,tp.PROPERTY_ADDR ,u.REAL_NAME,t.EST_PART_TIME,ta.ID_,ta.PROC_INST_ID_,sysOrg.id
        
                  )as a ) t2 on t1.id=t2.orgId 
                  
                  <ifNotNull organId>
							   where t1.id = #organId#
				  </ifNotNull>
				]]>
			</baseSql>
			<orderBySql>
			</orderBySql>
			<groupSql>
			</groupSql>
		</searchSql>
		<grid>
			<table-row>
			
			
				<column type="both" name="orgName1"  title="贵宾服务部" customDict=""  hidden="false"/>
				<column type="both" name="realName1"  title="总监" customDict="" hidden="false"/>
				<column type="both" name="orgName2"  title="组别" customDict=""  hidden="false"/>
				<column type="both" name="realName2" title="主管" customDict=""  hidden="false"/>
				
				<column type="both" name="color" title="红黄灯" customDict="" hidden="false"/>
				<column type="virtual" name="color1" title="红黄灯" referencecol="color"  customDict="convertColor" hidden="false"/>
				<column type="both" name="CASE_CODE"  title="案件编号" customDict=""  hidden="false"/>
				<column type="both" name="TASKNAME"  title="任务名" customDict=""  hidden="false"/>
				<column type="both" name="PROPERTY_ADDR"  title="产证地址" customDict="" hidden="false"/>
				<column type="both" name="REAL_NAME"  title="经办人" customDict="" hidden="false"/>
				<column type="both" name="EST_PART_TIME"  title="预计完成时间" customDict="" beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss" hidden="false"/>
				<column type="both" name="PROPERTY_ADDR"  title="产证地址" customDict=""  hidden="false"/>
				<column type="both" name="IMPORTTIME" title="导出时间" customDict=""  beanFormatter="dateFormatter" expType="date" expFmt="yyyy-MM-dd HH:mm:ss" hidden="false"/>
				
			</table-row>
		</grid>
	</query>
	
	
</querys>
