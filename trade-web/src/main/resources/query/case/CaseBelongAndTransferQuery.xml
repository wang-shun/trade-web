<?xml version="1.0" encoding="UTF-8"?>
<querys>
    <dicts>
        <customDict id="partName" beanName="qqcdDictPartName"></customDict>
    </dicts>
    <formatters>
        <formatter id="dateFormatter" ref="" class="com.aist.common.quickQuery.formatter.DateFormatter">
            <properties>
                <property name="pattern">yyyy-MM-dd</property>
            </properties>
        </formatter>
        <formatter id="numberFormater" ref="" class="com.aist.common.quickQuery.formatter.NumberFormatter">
            <properties>
                <property name="groupingUsed">true</property>
                <property name="maximumFractionDigits">3</property>
                <property name="maximumIntegerDigits">40</property>
                <property name="minimumFractionDigits">0</property>
                <property name="minimumIntegerDigits">1</property>
            </properties>
        </formatter>
        <formatter id="integerFormater" ref="" class="com.aist.common.quickQuery.formatter.NumberFormatter">
            <properties>
                <property name="maximumFractionDigits">0</property>
            </properties>
        </formatter>
        <formatter id="emailFormater" ref="" class="com.aist.common.quickQuery.formatter.EmailFormatter"/>
    </formatters>

    <query id="queryCaseBelongAndTransfer">
        <searchCondition>

        </searchCondition>
        <searchSql>
            <baseSql>
                <![CDATA[
					SELECT
                        uoj.user_id userId
                        ,u.real_name userName
                        ,o.org_name orgName
                        ,uoj.org_id orgId
                        ,(select count(1) from sctrans.T_TG_SERV_ITEM_AND_PROCESSOR t1 where exists (select 1 from sctrans.T_TO_CASE t2 where t2.CASE_CODE=t1.CASE_CODE and t2.CASE_PROPERTY not in ('30003002','30003005')  ) and t1.PROCESSOR_ID=uoj.user_id and t1.SRV_CAT='30004010' ) as PROCESSOR_COUNT
                        ,(select count(1) from sctrans.T_TG_SERV_ITEM_AND_PROCESSOR t1 where exists (select 1 from sctrans.T_TO_CASE t2 where t2.CASE_CODE=t1.CASE_CODE and t2.CASE_PROPERTY not in ('30003002','30003005')  ) and t1.PROCESSOR_ID=uoj.user_id and t1.SRV_CODE='3000400101' ) as COM_MORT_COUNT
                        ,(select count(1) from sctrans.T_TG_SERV_ITEM_AND_PROCESSOR t1 where exists (select 1 from sctrans.T_TO_CASE t2 where t2.CASE_CODE=t1.CASE_CODE and t2.CASE_PROPERTY not in ('30003002','30003005')  ) and t1.PROCESSOR_ID=uoj.user_id and t1.SRV_CODE='3000400201' ) as PRF_MORT_COUNT
                        ,(select count(1) from sctrans.T_TO_ELOAN_CASE t1 where exists (select 1 from sctrans.T_TO_CASE t2 where t2.CASE_CODE=t1.CASE_CODE and t2.CASE_PROPERTY not in ('30003002','30003005')  ) and EXCUTOR_ID=uoj.user_id) as ELOAN_COUNT
                        ,(select count(1) from sctrans.T_TO_SPV t1 where exists (select 1 from sctrans.T_TO_CASE t2 where t2.CASE_CODE=t1.CASE_CODE and t2.CASE_PROPERTY not in ('30003002','30003005')  ) and APPLY_USER=uoj.user_id) as SPV_COUNT
                        ,(select count(1) FROM sctrans.ACT_RU_TASK ART INNER JOIN sctrans.T_TO_WORKFLOW AS tw ON ART.PROC_INST_ID_  =tw.INST_CODE WHERE  ART.ASSIGNEE_ =u.USERNAME AND ART.SUSPENSION_STATE_ = '1') as ASSIGNEE_COUNT
                    FROM
                        sctrans.sys_user_org_job uoj
                        ,(select * from sctrans.SYS_ORG t1 where t1.PARENT_ID=#userOrg#
                            union all
                          select * from sctrans.SYS_ORG t1 where t1.ID=#userOrg#
                          ) o
                        ,sctrans.sys_user u
                        ,sctrans.sys_job j
                    WHERE
                        uoj.org_id = o.id
                        AND uoj.user_id = u.id
                        AND uoj.job_id = j.id
                        and j.job_code =#selectJobCode#
				]]>
            </baseSql>
            <groupSql>
            </groupSql>
        </searchSql>
        <grid>
            <table-row>
                <column type="both" name="userId" index="" checkbox="" title="用户ID" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="userName" index="" checkbox="" title="用户名称" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="orgName" index="" checkbox="" title="组织名" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="orgId" index="" checkbox="" title="组织ID" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />

                <column type="both" name="PROCESSOR_COUNT" index="" checkbox="" title="后台归属" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="COM_MORT_COUNT" index="" checkbox="" title="后台归属" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="PRF_MORT_COUNT" index="" checkbox="" title="后台归属" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="ELOAN_COUNT" index="" checkbox="" title="E+归属" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="SPV_COUNT" index="" checkbox="" title="资管归属" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="ASSIGNEE_COUNT" index="" checkbox="" title="任务归属" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
            </table-row>
        </grid>
    </query>

    <query id="queryCaseBelongAndTransferDetail">
        <searchCondition>

        </searchCondition>
        <searchSql>
            <baseSql>
                <![CDATA[
					select
                        t1.CASE_CODE
                        ,t2.PROPERTY_ADDR
                        ,t3.CREATE_TIME as CREATE_TIME
                        ,(select TOP(1)NAME from sctrans.SYS_DICT where CODE=t1.SRV_CODE AND TYPE='yu_serv_cat_code_tree') AS SRV_CODE_NAME
                        ,t1.PROCESSOR_ID
                        ,(select REAL_NAME from sctrans.SYS_USER where ID = t1.PROCESSOR_ID) AS REAL_NAME
                        ,(select ORG_NAME from sctrans.SYS_ORG where id=t1.ORG_ID) AS ORG_NAME

                        from sctrans.T_TG_SERV_ITEM_AND_PROCESSOR t1
                        left join sctrans.T_TO_PROPERTY_INFO t2 on t1.CASE_CODE=t2.CASE_CODE
                        left join sctrans.T_TO_CASE t3 on t2.CASE_CODE=t3.CASE_CODE
                        where
                        PROCESSOR_ID=#MuserId#
                        <ifNotNull srvCatType>
						    and SRV_CAT=#srvCatType#
				    	</ifNotNull>
                        <ifNotNull caseCode>
						    and t1.CASE_CODE=#caseCode#
				    	</ifNotNull>
                        <ifNotNull caseAddress>
						    and t2.PROPERTY_ADDR like  '%' + #caseAddress# + '%'
				    	</ifNotNull>
				]]>
            </baseSql>
            <groupSql>
            </groupSql>
        </searchSql>
        <grid>
            <table-row>
                <column type="both" name="CASE_CODE" index="" checkbox="" title="案件编号" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="PROPERTY_ADDR" index="" checkbox="" title="案件地址" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="CREATE_TIME" title="案件创建时间" customDict=""  beanFormatter="dateFormatter" expType="date" expFmt="yyyy/MM/dd" />
                <column type="both" name="SRV_CODE_NAME" index="" checkbox="" title="任务名称" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="REAL_NAME" index="" checkbox="" title="经办人" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
                <column type="both" name="ORG_NAME" index="" checkbox="" title="组别" customDict="" sysDict="" format="" width="150" isSort="" align="" halign="" resizable="" />
            </table-row>
        </grid>
    </query>
</querys>