<?xml version="1.0" encoding="UTF-8"?>
<querys>
	<dicts>
		<customDict id="qqcdSrvCode" beanName="qqcdSrvCode"></customDict>
	</dicts>
	<formatters>
			<formatter id="dateFormatter" ref=""
				class="com.aist.common.quickQuery.formatter.DateFormatter">
				<properties>
					<property name="pattern">yyyy-MM-dd</property>
				</properties>
			</formatter>
	</formatters>
	<query id="baseAwardQuery">
		<searchSql>
			<baseSql>
				<![CDATA[
					select 
						sab.case_code,pi.property_addr,tab.guohu_time,sab.sum_base_amount
			        from 
			                (select case_code,sum(base_amount) sum_base_amount from sctrans.t_ts_award_base 
			                	where PARTICIPANT = #userId#
			                group by case_code) sab
			        left join
			                (select case_code, max(guohu_time) guohu_time from sctrans.t_ts_award_base 
			                	where PARTICIPANT = #userId#
			                group by case_code ) tab
			        on sab.case_code = tab.case_code
			        left join sctrans.t_to_property_info pi on tab.case_code = pi.case_code
			        where 1 = 1
			        <if test="caseCode != null and caseCode != '' ">
			        	and sab.case_code = #caseCode#
			        </if>
			        <if test="propertyAddr != null and propertyAddr != '' ">
			        	and pi.property_addr like '%' + #propertyAddr# + '%'
			        </if>
			        <if test="belongMonth != null and belongMonth != '' " >
			        	AND DATEDIFF(mm,tab.guohu_time,#belongMonth#) = 0
			        </if>
			        order by guohu_time desc
				]]>
			</baseSql>
		</searchSql>
		<grid>
			<table-row>
				<column name="CASE_CODE"   />
				<column name="PROPERTY_ADDR"   />
				<column name="GUOHU_TIME"   beanFormatter="dateFormatter"/>
				<column name="SUM_BASE_AMOUNT"   />
			</table-row>
		</grid>
	</query>
	
	<query id="awardInfoList">
		<searchSql>
			<baseSql>
				<![CDATA[
					select 
					   	SRV_CODE,
					   	BASE_AMOUNT,
					   	SRV_PART_IN,
					   	SRV_PART_TOTAL
					from sctrans.t_ts_award_base
					where case_Code = #caseCode# 
					   	and PARTICIPANT = #userId#
				]]>
			</baseSql>
		</searchSql>
		<grid>
			<table-row>
				<column name="SRV_CODE"   customDict="qqcdSrvCode" />
				<column name="BASE_AMOUNT"   />
				<column name="SRV_PART_IN"   />
				<column name="SRV_PART_TOTAL"   />
			</table-row>
		</grid>
	</query>
</querys>