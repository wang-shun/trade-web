<?xml version="1.0" encoding="UTF-8"?>
<querys>
	<dicts>
		<customDict id="getShowTime" beanName="getShowTime"></customDict>
		<customDict id="getFlowupInfoList" beanName="getFlowupInfoList"></customDict>
		<customDict id="getTransactItemCodeList" beanName="getTransactItemCodeList"></customDict>
	</dicts>
	<formatters>
		<formatter id="dateFormatter" ref=""
			class="com.aist.common.quickQuery.formatter.DateFormatter">
			<properties>
				<property name="pattern">yyyy/MM/dd</property>
			</properties>
		</formatter>
		<formatter id="dateFormatter1" ref=""
			class="com.aist.common.quickQuery.formatter.DateFormatter">
			<properties>
				<property name="pattern">yyyy-MM-dd</property>
			</properties>
		</formatter>
		<formatter id="dateFormatter2" ref=""
			class="com.aist.common.quickQuery.formatter.DateFormatter">
			<properties>
				<property name="pattern">yyyy-MM-dd HH:mm</property>
			</properties>
		</formatter>
		<formatter id="numberFormater" ref=""
			class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="groupingUsed">true</property>
				<property name="maximumFractionDigits">3</property>
				<property name="maximumIntegerDigits">40</property>
				<property name="minimumFractionDigits">0</property>
				<property name="minimumIntegerDigits">1</property>
			</properties>
		</formatter>
		<formatter id="integerFormater" ref=""
			class="com.aist.common.quickQuery.formatter.NumberFormatter">
			<properties>
				<property name="maximumFractionDigits">0</property>
			</properties>
		</formatter>
		<formatter id="emailFormater" ref=""
			class="com.aist.common.quickQuery.formatter.EmailFormatter" />
	</formatters>
	<query id="signingList">
		<searchSql>
			<baseSql>
				<![CDATA[
					SELECT r.PKID AS resId,r.RES_NO AS resNo,rs.START_DATE AS resDateTime,getdate() as currentDate,sr.ROOM_NO AS roomNO,sr.ROOM_TYPE as roomType,
					r.NUMBE_OF_ACCOMMODATE_PEOPLE AS numberOfPeople,r.NUMBER_OF_PARTICIPANTS AS numberOfParticipants,rs.START_DATE AS startTime,rs.END_DATE AS endTime,
					r.CHECK_IN_TIME AS checkInTime,r.CHECKED_OUT_TIME AS checkOutTime,r.RES_STATUS AS resStatus,r.SIGNING_CENTER_ID as tradeCenterId,
					r.RES_PERSON_ID AS resPersonId,u.REAL_NAME AS realName,u.MOBILE AS mobile,r.SPECIAL_REQUIREMENT AS specialReq,
					(SELECT COMMENT FROM sctrans.T_RM_RES_FLOW_UP WHERE RES_ID = r.PKID ORDER BY CREATE_TIME DESC OFFSET 0 ROWS FETCH  next 1 ROWS ONLY) as latestComment,
					(SELECT CREATE_TIME FROM sctrans.T_RM_RES_FLOW_UP WHERE RES_ID = r.PKID ORDER BY CREATE_TIME DESC OFFSET 0 ROWS FETCH  next 1 ROWS ONLY) as followDateTime,
					r.SERVICE_SPECIALIST as serviceSpecialist,r.TRANSACT_ITEM_CODE as transactItemCode,DATEDIFF(minute, rs.END_DATE,GETDATE()) AS timeDifference
					FROM sctrans.T_RM_RESERVATION r
					LEFT JOIN sctrans.T_RM_ROOM_SCHEDULE rs ON r.SCHEDULE_ID = rs.PKID
					LEFT JOIN sctrans.T_RM_SIGN_ROOM sr ON rs.ROOM_ID = sr.PKID
					LEFT JOIN sctrans.SYS_USER u ON r.RES_PERSON_ID = u.ID
					where r.SIGNING_CENTER_ID in (SELECT DISTINCT TRADE_CENTER_ID FROM sctrans.T_RM_SIGN_ROOM_ORG_MAPPING WHERE DISTRICT_ID = #distinctId#)
					<ifNotNull resPersonId>	
   						and r.RES_PERSON_ID = #resPersonId# 
				    </ifNotNull>
				    
				    <ifNotNull resNo>	
   						and r.RES_NO like '%' + #resNo# + '%'
				    </ifNotNull>
				    
				    <ifNotNull mobile>	
   						and u.MOBILE like '%' + #mobile# + '%'
				    </ifNotNull>
				    
				    <ifNotNull startDateTime>
				    	and CONVERT(varchar(100),rs.START_DATE, 23) >= #startDateTime#
				    </ifNotNull>
				    
				    <ifNotNull endDateTime>
				    	and CONVERT(varchar(100),rs.START_DATE, 23) &lt;= #endDateTime#
				    </ifNotNull>
				    
				    <ifNotNull startResTime>
				    	and CONVERT(varchar(100), rs.START_DATE, 8) = #startResTime#
				    </ifNotNull>
				    
				    <ifNotNull endResTime>
				    	and CONVERT(varchar(100), rs.END_DATE, 8) = #endResTime#
				    </ifNotNull>
				    
				    <if test="resStatus != null and resStatus != ''">
				    	and r.RES_STATUS = #resStatus#
				    </if>
				]]>
			</baseSql>
			<orderBySql>
				ORDER BY r.CREATE_TIME DESC
			</orderBySql>
			<groupSql>
			</groupSql>
		</searchSql>
		<grid>
			<table-row>
				<column type="both" name="resId" index="" checkbox="" display="resId" customDict="" sysDict="" format="" width="0" isSort="" align="" halign="" order="desc" resizable="" hide="true"/>
				<column type="virtual" name="flowupInfoList" title="跟进信息列表" referencecol="resId" customDict="getFlowupInfoList" />
				<column type="both" name="resNo" index="" checkbox="" display="预约单编号" title="预约单编号" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="resDateTime"  index="" checkbox="" display="预约日期" title="预约日期" beanFormatter="dateFormatter1" sysDict="" format=""  width="120" isSort="true" align="" halign="" order="" resizable="" />
				<column type="both" name="currentDate"  index="" checkbox="" display="当前日期" title="当前日期" beanFormatter="dateFormatter1" sysDict="" format=""  width="120" isSort="true" align="" halign="" order="" resizable="" />
				<column type="both" name="roomNO" index="" checkbox="" display="房间编号" title="房间编号" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="roomType" index="" checkbox="" display="房间类型" title="房间类型" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="numberOfPeople" index="" checkbox="" display="房间容纳人数" title="房间容纳人数" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="startTime" index="" checkbox="" display="预约开始时间" title="预约开始时间" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="virtual" name="actStartTime" title="预约开始时间" referencecol="startTime" customDict="getShowTime" />
				<column type="both" name="endTime" index="" checkbox="" display="预约结束时间" title="预约结束时间" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="virtual" name="actEndTime" title="预约结束时间" referencecol="endTime" customDict="getShowTime" />
				<column type="both" name="checkInTime"  index="" checkbox="" display="签到时间" title="签到时间" sysDict="" format=""  width="120" isSort="true" align="" halign="" order="" resizable="" />
				<column type="virtual" name="actCheckInTime" title="签到时间" referencecol="checkInTime" customDict="getShowTime" />
				<column type="both" name="checkOutTime"  index="" checkbox="" display="签出时间" title="签出时间" sysDict="" format=""  width="120" isSort="true" align="" halign="" order="" resizable="" />
				<column type="virtual" name="actCheckOutTime" title="签退时间" referencecol="checkOutTime" customDict="getShowTime" />
				<column type="both" name="resStatus" display="预约状态" title="预约状态" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="realName" index="" checkbox="" display="预约人姓名" title="预约人姓名" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="mobile" index="" checkbox="" display="手机号" title="手机号" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="specialReq" index="" checkbox="" display="特殊需求" title="特殊需求" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="followDateTime"  index="" checkbox="" display="最新跟进时间" title="最新跟进时间" beanFormatter="dateFormatter2" sysDict="" format=""  width="120" isSort="true" align="" halign="" order="" resizable="" />
				<column type="both" name="latestComment" index="" checkbox="" display="最新跟进信息" title="最新跟进信息" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="numberOfParticipants" index="" checkbox="" display="参加人数" title="参加人数" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="serviceSpecialist" index="" checkbox="" display="服务顾问" title="服务顾问" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="transactItemCode" index="" checkbox="" display="办理事项" title="办理事项" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="virtual" name="transactItemCodeList" title="办理事项列表" referencecol="transactItemCode" customDict="getTransactItemCodeList" />
				<column type="both" name="timeDifference" index="" checkbox="" display="时间差" title="时间差" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
				<column type="both" name="tradeCenterId" index="" checkbox="" display="交易中心id" title="交易中心id" customDict="" sysDict="" format="" width="90" isSort="true" align="" halign="" order="desc" resizable=""/>
			</table-row>
		</grid>
	</query>
</querys>
