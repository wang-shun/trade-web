<?xml version="1.0" encoding="UTF-8"?>
<querys id="tasks">
	<query id="getAllYCCW">
		<searchScript>
           SELECT u.REAL_NAME as name,j.JOB_CODE FROM sctrans.SYS_USER_ORG_JOB uj
           LEFT JOIN sctrans.sys_job j on uj.JOB_ID=j.ID
           LEFT JOIN sctrans.sys_user u on uj.user_ID=u.ID
			<where>
			    j.JOB_CODE='YCCWREVIEW' AND uj.IS_DELETED='0'
			</where>
		</searchScript>
		<grid>
			<column name="name"/>
			<column name="JOB_CODE"/>
		</grid>
	</query>
	<query id="getGroup">
		<searchScript>
		<if test="#searchType=='user'">
		 SELECT users.ID as id ,users.REAL_NAME as name FROM sctrans.SYS_USER users
		 <where>
			  <trim prefix="and" prefixOverrides="and|or">
			  users.is_deleted=0
			   <if test="#parentId !=null and #parentId != ''">
			  and users.ORG_ID=#{parentId}
			  </if>
			  <if test="#gb=='true'" >
			  and users.ORG_NAME like '%贵宾服务部%'
			  </if>
			   </trim>
			</where>
		</if>
		<if test="#searchType=='group'">
           SELECT so.ID as id ,so.ORG_NAME as name FROM sctrans.SYS_ORG so
			<where>
			  <trim prefix="and" prefixOverrides="and|or">
			  so.is_deleted=0
			   <if test="#parentId !=null and #parentId != ''">
			   and so.PARENT_ID=#{parentId}
			  </if>
			  <if test="#gb=='true'" >
			  and so.ORG_NAME like '%贵宾服务部%'
			  </if>
			   </trim>
			</where>
		  </if> 
		</searchScript>
		<grid>
			 <column name="id" title="id" hidden="true" />
		     <column name="name" title="name" hidden="true" />
		</grid>
	</query>
	
		<query id="getQD">
		<searchScript>
		<if test="#jobCode!='JQYDS'">
		 with o as(
			    select p.id,p.parent_id from sctrans.sys_org p where p.id =#{orgId} and p.is_deleted=0
			    union all
			    select c.id,c.parent_id from o inner join sctrans.sys_org c on c.parent_id = o.id and c.is_deleted=0
			) 
		</if>
			SELECT uoj.user_id,uoj.org_id, org.org_name,uoj.job_id,uoj.job_name,uoj.real_name FROM sctrans.v_user_org_job uoj 
			INNER join sctrans.sys_org org on uoj.org_id=org.id
			<where>
			 <trim prefix="and" prefixOverrides="and|or">
			    uoj.job_code =#{jobCode}
				<if test="#jobCode!='JQYDS'">
				 and exists(select 1 from o where uoj.org_id = o.id)
				</if>
			   </trim>
			</where>
		</searchScript>
		<grid>
			 <column name="user_id" title="user_id" hidden="true" />
		     <column name="org_id" title="org_id" hidden="true" />
		     <column name="org_name" title="org_name" hidden="true" />
		     <column name="job_id" title="job_id" hidden="true" />
		     <column name="job_name" title="job_name" hidden="true" />
		     <column name="real_name" title="real_name" hidden="true" />
		</grid>
	</query>

   <query id="getFH">
		<searchScript>
            select id as org_id,org_name from sctrans.sys_org
			<where>
			 <trim prefix="and" prefixOverrides="and|or">
			    is_deleted=0
				<if test="#parentId !=null and #parentId != ''">
				and parent_id=#{parentId}
				</if>
			   </trim>
			</where>
		</searchScript>
		<grid>
		     <column name="org_id" title="org_id" hidden="true" />
		     <column name="org_name" title="org_name" hidden="true" />
		</grid>
	</query>
</querys>